<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bubble Panel</title>
<style>
body { font-family: sans-serif; padding: 20px; }
.board { margin-bottom: 30px; }
button { margin: 5px; padding: 6px 10px; cursor:pointer; }
</style>
</head>
<body>

<h2>Bubble Panel</h2>
<div id="boards"></div>

<script>
async function loadBubbles() {
    const res = await fetch("index.json");
    const data = await res.json();
    const container = document.getElementById("boards");

    for (const board in data) {
        const div = document.createElement("div");
        div.className = "board";

        const title = document.createElement("h3");
        title.textContent = board;
        div.appendChild(title);

        data[board].forEach(file => {
            const btn = document.createElement("button");
            btn.textContent = file.replace(".md", "");
            btn.onclick = () => copyPayload(board, file);
            div.appendChild(btn);
        });

        container.appendChild(div);
    }
}

async function copyPayload(board, file) {
    const path = "bubbles/" + board + "/" + file;
    const res = await fetch(path);
    const text = await res.text();

    const start = text.indexOf("# 🧠 PAYLOAD");
    if (start === -1) {
        alert("PAYLOAD not found");
        return;
    }

    const after = text.substring(start);
    const nextHeader = after.indexOf("\n# ", 1);
    const payload = nextHeader === -1 ? after : after.substring(0, nextHeader);

    const cleaned = payload.replace("# 🧠 PAYLOAD", "").trim();

    await navigator.clipboard.writeText(cleaned);
    alert("PAYLOAD copied");
}

loadBubbles();
</script>

</body>
</html>
